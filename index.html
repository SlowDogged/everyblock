<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Minecraft Block Checklist</title>
  <style>
    :root {
      --bg: #f4f4f4;
      --fg: #222;
      --card: #fff;
      --shadow: rgba(0,0,0,0.1);
    }
    [data-theme="dark"] {
      --bg: #1e1e1e;
      --fg: #ddd;
      --card: #2a2a2a;
      --shadow: rgba(0,0,0,0.5);
    }
    * { box-sizing:border-box; margin:0; padding:0 }
    body {
      background: var(--bg);
      color: var(--fg);
      font-family: sans-serif;
      display:flex; flex-direction:column;
      min-height:100vh;
    }
    header {
      display:flex; justify-content:space-between; align-items:center;
      padding:1rem; background:var(--card);
      box-shadow:0 2px 4px var(--shadow);
    }
    header h1 { font-size:1.2rem }
    .toggle {
      font-size:1.5rem; cursor:pointer; user-select:none;
    }
    #list {
      flex:1; padding:1rem;
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(200px,1fr));
      gap:1rem; overflow-y:auto;
    }
    .item {
      background:var(--card); padding:.75rem;
      border-radius:6px; box-shadow:0 1px 3px var(--shadow);
      display:flex; align-items:center;
    }
    .item input { margin-right:.5rem }
    .error {
      padding:2rem; text-align:center; color:crimson;
    }
  </style>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>
  <header>
    <h1>ðŸ”² Minecraft Blocks</h1>
    <div class="toggle" id="dmToggle" title="Toggle Dark Mode">ðŸŒ“</div>
  </header>
  <div id="list">Loadingâ€¦</div>

  <script>
    // â€” Dark-mode toggle & persistence â€”
    const root = document.documentElement;
    const theme = localStorage.getItem('theme') || 'light';
    root.setAttribute('data-theme', theme);
    document.getElementById('dmToggle').onclick = () => {
      const next = root.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
      root.setAttribute('data-theme', next);
      localStorage.setItem('theme', next);
    };

    // â€” Firebase setup â€” fallback to localStorage if config missing/invalid
    let useFirebase = true;
    try {
    const firebaseConfig = {
      apiKey: "AIzaSyA71YiMka7LjljSbjFjahAtyhfoSjh4N74",
      authDomain: "everyblock-a9f76.firebaseapp.com",
      projectId: "everyblock-a9f76",
      storageBucket: "everyblock-a9f76.firebasestorage.app",
      messagingSenderId: "468379549163",
      appId: "1:468379549163:web:ac9444d549ff1c1597adae",
      measurementId: "G-98NHNBQG2X"
    };
      firebase.initializeApp(firebaseConfig);
    } catch(e) {
      console.warn('Firebase init failed:', e);
      useFirebase = false;
    }
    const dbRef = useFirebase
      ? firebase.database().ref('checkedBlocks')
      : null;

    // â€” Shared checked state â€”
    let checked = new Set(JSON.parse(localStorage.getItem('checkedBlocks') || '[]'));

    // If Firebase works, keep in sync
    if (useFirebase) {
      dbRef.on('value', snap => {
        const arr = snap.val() || [];
        checked = new Set(arr);
        // update UI if already rendered
        document.querySelectorAll('#list .item input').forEach(cb => {
          const name = cb.nextElementSibling.textContent.trim();
          cb.checked = checked.has(name);
        });
        // mirror to localStorage
        localStorage.setItem('checkedBlocks', JSON.stringify([...checked]));
      }, err => {
        console.error('Firebase read error:', err);
      });
    }

    // â€” PrismarineJS blocks.json (PC 1.21.3) :contentReference[oaicite:0]{index=0} â€”
    const JSON_URL = 'https://raw.githubusercontent.com/PrismarineJS/minecraft-data/master/data/pc/1.21.3/blocks.json';

    // Load & render
    async function loadBlocks() {
      try {
        const res = await fetch(JSON_URL);
        if (!res.ok) throw new Error(res.statusText);
        const data = await res.json();
        const names = data
          .map(b => b.displayName || b.name)
          .filter(n => n && !n.startsWith('debug:'))
          .sort((a,b) => a.localeCompare(b));

        const list = document.getElementById('list');
        list.innerHTML = '';
        names.forEach(name => {
          const id = `blk_${name.replace(/[^a-z0-9]/gi,'_')}`;
          const label = document.createElement('label');
          label.className = 'item';
          label.innerHTML = `
            <input type="checkbox" id="${id}">
            <span>${name}</span>
          `;
          const cb = label.querySelector('input');
          // initialize from our Set
          cb.checked = checked.has(name);
          // on change, update both Firebase & localStorage
          cb.addEventListener('change', () => {
            if (cb.checked) checked.add(name);
            else checked.delete(name);
            if (useFirebase) dbRef.set([...checked]);
            localStorage.setItem('checkedBlocks', JSON.stringify([...checked]));
          });
          list.appendChild(label);
        });
      } catch(err) {
        document.getElementById('list').innerHTML =
          `<div class="error">Failed to load block list.<br>${err.message}</div>`;
      }
    }

    loadBlocks();
  </script>
</body>
</html>
