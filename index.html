<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Minecraft Block Checklist</title>
  <style>
    :root {
      --bg: #f4f4f4;
      --fg: #222;
      --card: #fff;
      --shadow: rgba(0,0,0,0.1);
    }
    [data-theme="dark"] {
      --bg: #1e1e1e;
      --fg: #ddd;
      --card: #2a2a2a;
      --shadow: rgba(0,0,0,0.5);
    }
    * { box-sizing:border-box; margin:0; padding:0 }
    body {
      background: var(--bg);
      color: var(--fg);
      font-family: sans-serif;
      display:flex; flex-direction:column;
      min-height:100vh;
    }
    header {
      display:flex; justify-content:space-between; align-items:center;
      padding:1rem; background:var(--card);
      box-shadow:0 2px 4px var(--shadow);
    }
    header h1 { font-size:1.2rem }
    .toggle {
      font-size:1.5rem; cursor:pointer; user-select:none;
    }
    #list {
      flex:1; padding:1rem;
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(200px,1fr));
      gap:1rem; overflow-y:auto;
    }
    .item {
      background:var(--card); padding:.75rem;
      border-radius:6px; box-shadow:0 1px 3px var(--shadow);
      display:flex; align-items:center;
    }
    .item input { margin-right:.5rem }
    .error {
      padding:2rem; text-align:center; color:crimson;
    }
  </style>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>
  <header>
    <h1>🔲 Minecraft Blocks</h1>
    <div class="toggle" id="dmToggle" title="Toggle Dark Mode">🌓</div>
  </header>
  <div id="list">Loading…</div>

  <script>
    // —— Dark mode toggle & persistence ——
    const docEl = document.documentElement;
    const savedTheme = localStorage.getItem('theme') || 'light';
    docEl.setAttribute('data-theme', savedTheme);
    document.getElementById('dmToggle').onclick = () => {
      const next = docEl.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
      docEl.setAttribute('data-theme', next);
      localStorage.setItem('theme', next);
    };

    // —— Your Firebase config here ⚙️ ——
    const firebaseConfig = {
      apiKey: "AIzaSyA71YiMka7LjljSbjFjahAtyhfoSjh4N74",
      authDomain: "everyblock-a9f76.firebaseapp.com",
      projectId: "everyblock-a9f76",
      storageBucket: "everyblock-a9f76.firebasestorage.app",
      messagingSenderId: "468379549163",
      appId: "1:468379549163:web:ac9444d549ff1c1597adae",
      measurementId: "G-98NHNBQG2X"
    };
    // Initialize Firebase & get DB ref
    firebase.initializeApp(firebaseConfig);
    const dbRef = firebase.database().ref('checkedBlocks');

    // —— PrismarineJS blocks.json URL (PC 1.21.3) :contentReference[oaicite:0]{index=0} ——
    const JSON_URL = 'https://raw.githubusercontent.com/PrismarineJS/minecraft-data/master/data/pc/1.21.3/blocks.json';

    let checked = new Set();  // will hold current checked names

    // Listen for global changes
    dbRef.on('value', snap => {
      const arr = snap.val() || [];
      checked = new Set(arr);
      // If list already rendered, update UI
      document.querySelectorAll('#list .item').forEach(label => {
        const name = label.textContent.trim();
        label.querySelector('input').checked = checked.has(name);
      });
    });

    // Load blocks, render checkboxes, wire up events
    async function loadBlocks() {
      try {
        const res = await fetch(JSON_URL);
        if (!res.ok) throw new Error(res.statusText);
        const data = await res.json();
        const names = data
          .map(b => b.displayName || b.name)
          .filter(n => n && !n.startsWith('debug:'))
          .sort((a,b)=>a.localeCompare(b));

        const container = document.getElementById('list');
        container.innerHTML = '';

        names.forEach(name => {
          const id = `blk_${name.replace(/[^a-z0-9]/gi,'_')}`;
          const label = document.createElement('label');
          label.className = 'item';
          label.innerHTML = `
            <input type="checkbox" id="${id}">
            <span>${name}</span>
          `;
          const cb = label.querySelector('input');
          // initialize state (in case DB already loaded)
          cb.checked = checked.has(name);
          // on toggle, update Firebase
          cb.addEventListener('change', () => {
            if (cb.checked) checked.add(name);
            else checked.delete(name);
            dbRef.set([...checked]);
          });
          container.appendChild(label);
        });
      } catch (err) {
        document.getElementById('list').innerHTML =
          `<div class="error">Failed to load block list.<br>${err.message}</div>`;
      }
    }

    loadBlocks();
  </script>
</body>
</html>
